\documentclass[a4paper,12pt]{report}
\usepackage[utf8]{inputenc}
\usepackage{fontenc}
\usepackage{a4wide}
\usepackage{graphicx}
\usepackage{placeins}
%pour la mise en page des tableaux
\usepackage{graphicx}
\usepackage{placeins}
\usepackage{rotating}
\usepackage{array}
\usepackage{tabularx}
\usepackage[table,xcdraw]{xcolor}
\usepackage{wrapfig}
\usepackage{subcaption}
\usepackage{color, colortbl}
\definecolor{Gray}{gray}{0.9}
\definecolor{LightCyan}{rgb}{0.88,1,1}
\usepackage{fancyhdr}

\usepackage{longtable}
\usepackage{float}
\usepackage{array} % for 
\usepackage{amsthm}
\usepackage{amssymb,amsmath,bbm}
\usepackage{fontspec}          % For font management in XeLaTeX
\usepackage{unicode-math}      % Allows math font selection

% Set a math font that supports all symbols
\setmathfont{Latin Modern Math}
\usepackage{xcolor}
\usepackage{tcolorbox}
\usepackage{lscape}
\usepackage{afterpage}
\usepackage{rotating}
\usepackage[nottoc,notlof,notlot]{tocbibind}
\usepackage{tocloft}
\usepackage{pdfpages}
\graphicspath{{images/}{images_pfe/}}
\newlength\figureheight
\newlength\figurewidth
\usepackage{ifthen}
\usepackage{ifpdf}
\ifpdf
\usepackage[pdftex]{hyperref}
\else
\usepackage{hyperref}
\fi
\usepackage{color}
\hypersetup{%
colorlinks=true,
linkcolor=black,
citecolor=black,
urlcolor=blue}
% \urlstyle{same}
\usepackage[top=2.5cm,bottom=2.5cm,right=2.5cm,left=2.5cm]{geometry}
\usepackage{changepage}

\usepackage{tabularx}
    \newcolumntype{L}{>{\raggedright\arraybackslash}X}
\usepackage{longtable}
\usepackage{tabularx}
    \newcolumntype{L}{>{\raggedright\arraybackslash}X}
\usepackage{longtable}

\usepackage{xltabular}
\renewcommand{\tablename}{Table}
\renewcommand{\figurename}{Figure}

% Colors package
\usepackage[table]{xcolor}
\usepackage{xcolor}

\definecolor{lightblue}{rgb}{0.74, 0.83, 0.9}

% Colors for tables package
\usepackage{colortbl}



\usepackage{tikz}
\usetikzlibrary{arrows,shapes,positioning,shadows,trees}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning}

\tikzset{
  basic/.style  = {draw, text width=2cm, drop shadow, font=\sffamily, rectangle},
  root/.style   = {basic, rounded corners=2pt, thin, align=center,
                   fill=blue!30},
  level 2/.style = {basic, rounded corners=6pt, thin,align=center, fill=blue!60,
                   text width=8em},
  level 3/.style = {basic, thin, align=left, fill=blue!10, text width=6.5em}
}



% --- LANGUAGE SETUP (LOADED LATE TO AVOID CONFLICTS) ---
\usepackage{polyglossia}
\setmainlanguage{english}
\setotherlanguage{french}
\setotherlanguage{arabic}
% \newfontfamily\arabicfont[Script=Arabic,Scale=1.3]{Scheherazade}

% --- Complete Bibliography Setup ---

% 1. Load biblatex with the core style options
\usepackage[
    backend=biber,
    style=authoryear, % Use author-year style
    autolang=other,
    maxcitenames=1,         % Use "et al." if more than 1 author
    doi=false,              % Your custom settings from before
    isbn=false,
    eprint=false,
    uniquelist=false
]{biblatex}

% 2. Link your .bib file
\addbibresource{references.bib}


% 3. This block changes citation parentheses to square brackets (works on older systems)
\usepackage{xpatch} % Make sure this package is loaded

% 4. Your other commands (non-italic "et al.", remove URLs, etc.)
\DefineBibliographyStrings{english}{%
  andothers = {et\addabbrvspace al\adddot},
}


% 5. Your command to remove URLs from the final reference list
\AtEveryBibitem{
  \ifentrytype{misc}{
  }{
    \clearfield{url}
    \clearfield{urlyear}
  }
}

% --- End of Bibliography Setup ---
%% pour la numération des sous sou sections
\setcounter{tocdepth}{2}
\setcounter{secnumdepth}{2}



% pour les algorithmes
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
\DontPrintSemicolon

\setlength\arrayrulewidth{1pt}
\renewcommand{\baselinestretch}{1.05}
\pagestyle{fancy}
\fancyhf{}
\lhead{\bfseries\nouppercase{\leftmark}}
\rfoot{\bfseries\thepage}
\setlength{\headheight}{14.5pt}

\let\headruleORIG\headrule

\renewcommand{\headrule}{\color{black} \headruleORIG}
\renewcommand{\headrulewidth}{1.0pt}
\usepackage{colortbl}
\arrayrulecolor{black}

\fancypagestyle{plain}{
  \fancyhead{}
  \fancyfoot[R]{\bfseries\thepage}
  \renewcommand{\headrulewidth}{0pt}
}


\makeatletter
\def\@textbottom{\vskip \z@ \@plus 1pt}
\let\@texttop\relax
\makeatother

\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else%
  \hbox{}%
  \thispagestyle{empty}%
  \newpage%
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother


\usepackage{array}
\usepackage{bm}
\usepackage{multirow}
\usepackage[footnote]{acronym}

\usepackage[bottom]{footmisc}



\newtheoremstyle{break}
  {11pt}{11pt}%
  {\itshape}{}%
  {\bfseries}{}%
  {\newline}{}%
\theoremstyle{break}

%\theoremstyle{definition}
\newtheorem{definition}{Définition}[chapter]

%\theoremstyle{definition}
\newtheorem{theoreme}{Théorème}[chapter]

%\theoremstyle{remark}
\newtheorem{remarque}{Remarque}[chapter]

%\theoremstyle{plain}
\newtheorem{propriete}{Propriété}[chapter]
\newtheorem{exemple}{Exemple}[chapter]

%table break line

\usepackage{makecell}

\renewcommand\theadalign{bl}
\renewcommand\theadfont{\bfseries}
\renewcommand\cellalign{bl}
\renewcommand\cellgape{\Gape[2pt]}

\parskip=5pt
%\sloppy
 %%%%********************************************************************
\usepackage{xcolor}
\definecolor{quotemark}{gray}{0.7}
\makeatletter
\def\fquote{%
    \@ifnextchar[{\fquote@i}{\fquote@i[]}%]
           }%
\def\fquote@i[#1]{%
    \def\tempa{#1}%
    \@ifnextchar[{\fquote@ii}{\fquote@ii[]}%]
                 }%
\def\fquote@ii[#1]{%
    \def\tempb{#1}%
    \@ifnextchar[{\fquote@iii}{\fquote@iii[]}%]
                      }%
\def\fquote@iii[#1]{%
    \def\tempc{#1}%
    \vspace{1em}%
    \noindent%
    \begin{list}{}{%
         \setlength{\leftmargin}{0.1\textwidth}%
         \setlength{\rightmargin}{0.1\textwidth}%
                  }%
         \item[]%
         \begin{picture}(0,0)%
         \put(-15,-5){\makebox(0,0){\scalebox{3}{\textcolor{quotemark}{``}}}}%
         \end{picture}%
         \begingroup\itshape}%
 %%%%********************************************************************
 \def\endfquote{%
 \endgroup\par%
 \makebox[0pt][l]{%
 \hspace{0.8\textwidth}%
 \begin{picture}(0,0)(0,0)%
 \put(15,15){\makebox(0,0){%
 \scalebox{3}{\color{quotemark}''}}}%
 \end{picture}}%
 \ifx\tempa\empty%
 \else%
    \ifx\tempc\empty%
       \hfill\rule{100pt}{0.5pt}\\\mbox{}\hfill\tempa,\ \emph{\tempb}%
   \else%
       \hfill\rule{100pt}{0.5pt}\\\mbox{}\hfill\tempa,\ \emph{\tempb},\ \tempc%
   \fi\fi\par%
   \vspace{0.5em}%
 \end{list}%
 }%
 \makeatother
 %%%%********************************************************************
 \usepackage{background}
% \backgroundsetup{scale = 0.5,angle = 0, opacity = 1, contents = {\includegraphics[scale = 0.65 ]{bg.jpg}}}
\backgroundsetup{
  % scale=1,         % You can also use width=... if you prefer exact sizing
  angle=0,        % Rotate image to make it vertical
  opacity = 0.9,
  position=current page.south west, % Bottom-left corner of the page
  vshift=10cm,      % Move it up from the bottom
  hshift=14.2cm,      % Move it right from the left margin
  contents={\includegraphics[scale = 0.65]{images_pfe/bg_uh2c.jpg}}
}
 \usepackage{afterpage}

\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
    \newpage}
    
\renewcommand{\listalgorithmcfname}{Liste des algorithmes}
\setmainlanguage{english}
\setotherlanguage{arabic}
\newfontfamily\arabicfont[Script=Arabic,Scale=1.3]{Scheherazade}

\newcommand{\mychapter}[2]{
    
    \chapter*{#2}
    \addcontentsline{toc}{chapter}{#2}
}


\usepackage[page,toc,titletoc,title]{appendix}

\addto\captionsfrench{%
  \renewcommand\appendixname{Annexe}
  \renewcommand\appendixpagename{Annexes}
  \renewcommand{\appendixtocname}{Annexes}
}
\usepackage{etoolbox}
\appto\appendix{\addtocontents{toc}{\protect\setcounter{tocdepth}{0}}}

% reinstate the correct level for list of tables and figures and algorithms
\appto\listoffigures{\addtocontents{lof}{\protect\setcounter{tocdepth}{1}}}
\appto\listoftables{\addtocontents{lot}{\protect\setcounter{tocdepth}{1}}}
\appto\listofalgorithms{\addtocontents{loa}{\protect\setcounter{tocdepth}{1}}}

\usepackage{xpatch} 

\AtBeginDocument{%
 
  \xpatchbibmacro{parencite}
    {\bibopenparen}
    {\bibopenbracket}
    {}{}
  \xpatchbibmacro{parencite}
    {\bibcloseparen}
    {\bibclosebracket}
    {}{}
}

\begin{document}

\pagenumbering{Roman}
\include{03-Resume}

\renewcommand{\cftpartleader}{\cftdotfill{\cftdotsep}} 
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}} 
\listoffigures
\clearpage
\listoftables
\clearpage
\include{04-Acronymes}


\clearpage
\tableofcontents
\clearpage


\cleardoublepage

\pagenumbering{arabic}
\include{05-Introduction}
\include{06-Context}
\include{07-Fonda}
\include{08-Sota}
\include{09-Our_approach}
\include{10-Realisation_Experiments}



\appendix
\appendixpage
\pagenumbering{roman}
% \input{12-Annexe.tex}


\clearpage
\thispagestyle{empty}



\printbibliography

\end{document}           